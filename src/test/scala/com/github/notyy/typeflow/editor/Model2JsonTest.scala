package com.github.notyy.typeflow.editor

import com.github.notyy.typeflow.Fixtures
import org.scalatest.{FunSpec, Matchers}

class Model2JsonTest extends FunSpec with Matchers {
  val model = Fixtures.model

  describe("Model2Json"){
    it("transform Model to Json string") {
      val json = Model2Json.execute(model)
      println(json)
      json shouldBe """{"name":"typeflow_editor","definitions":[{"jsonClass":"InputEndpoint","name":"UserInputEndpoint","outputType":{"name":"UserInput"}},{"jsonClass":"PureFunction","name":"UserInputInterpreter","inputs":[{"inputType":{"name":"UserInput"},"index":1}],"outputs":[{"outputType":{"name":"UnknownCommand"},"index":1},{"outputType":{"name":"QuitCommand"},"index":2},{"outputType":{"name":"CreateModelCommand"},"index":3},{"outputType":{"name":"AddInputEndpointCommand"},"index":4},{"outputType":{"name":"AddFunctionCommand"},"index":5},{"outputType":{"name":"AddOutputEndpointCommand"},"index":6},{"outputType":{"name":"CreateFlowCommand"},"index":7},{"outputType":{"name":"AddInstanceCommand"},"index":8},{"outputType":{"name":"ConnectElementCommand"},"index":9}]},{"jsonClass":"PureFunction","name":"WrapOutput","inputs":[{"inputType":{"name":"java.lang.Object"},"index":1}],"outputs":[{"outputType":{"name":"WrappedOutput"},"index":1}]},{"jsonClass":"OutputEndpoint","name":"CommandLineOutputEndpoint","inputs":[{"inputType":{"name":"WrappedOutput"},"index":1}],"outputType":{"name":"Unit"},"errorOutputs":[]}],"flows":[{"name":"minimalFlow","instances":[{"id":"UserInputEndpoint","definition":{"jsonClass":"InputEndpoint","name":"UserInputEndpoint","outputType":{"name":"UserInput"}}},{"id":"UserInputInterpreter","definition":{"jsonClass":"PureFunction","name":"UserInputInterpreter","inputs":[{"inputType":{"name":"UserInput"},"index":1}],"outputs":[{"outputType":{"name":"UnknownCommand"},"index":1},{"outputType":{"name":"QuitCommand"},"index":2},{"outputType":{"name":"CreateModelCommand"},"index":3},{"outputType":{"name":"AddInputEndpointCommand"},"index":4},{"outputType":{"name":"AddFunctionCommand"},"index":5},{"outputType":{"name":"AddOutputEndpointCommand"},"index":6},{"outputType":{"name":"CreateFlowCommand"},"index":7},{"outputType":{"name":"AddInstanceCommand"},"index":8},{"outputType":{"name":"ConnectElementCommand"},"index":9}]}},{"id":"WrapOutput","definition":{"jsonClass":"PureFunction","name":"WrapOutput","inputs":[{"inputType":{"name":"java.lang.Object"},"index":1}],"outputs":[{"outputType":{"name":"WrappedOutput"},"index":1}]}},{"id":"CommandLineOutputEndpoint","definition":{"jsonClass":"OutputEndpoint","name":"CommandLineOutputEndpoint","inputs":[{"inputType":{"name":"WrappedOutput"},"index":1}],"outputType":{"name":"Unit"},"errorOutputs":[]}},{"id":"CreateNewModel","definition":{"jsonClass":"OutputEndpoint","name":"CreateNewModel","inputs":[{"inputType":{"name":"CreateModelCommand"},"index":1}],"outputType":{"name":"ModelCreationSuccess"},"errorOutputs":[]}},{"id":"AddDefinition","definition":{"jsonClass":"PureFunction","name":"AddDefinition","inputs":[{"inputType":{"name":"Model"},"index":1},{"inputType":{"name":"AddDefinitionCommand"},"index":2}],"outputs":[{"outputType":{"name":"Model"},"index":1}]}},{"id":"Model2Json","definition":{"jsonClass":"PureFunction","name":"Model2Json","inputs":[{"inputType":{"name":"Model"},"index":1}],"outputs":[{"outputType":{"name":"java.lang.String"},"index":1}]}},{"id":"GetModelPath","definition":{"jsonClass":"PureFunction","name":"GetModelPath","inputs":[{"inputType":{"name":"Model"},"index":1}],"outputs":[{"outputType":{"name":"Path"},"index":1}]}},{"id":"SaveToFile","definition":{"jsonClass":"OutputEndpoint","name":"SaveToFile","inputs":[{"inputType":{"name":"Path"},"index":1},{"inputType":{"name":"java.lang.String"},"index":2}],"outputType":{"name":"Unit"},"errorOutputs":[{"outputType":{"name":"java.lang.String"},"index":1}]}},{"id":"OnSaveModelSuccess","definition":{"jsonClass":"PureFunction","name":"OnSaveModelSuccess","inputs":[{"inputType":{"name":"Model"},"index":1},{"inputType":{"name":"Unit"},"index":2}],"outputs":[{"outputType":{"name":"ModelUpdateSuccess"},"index":1}]}}],"connections":[{"fromInstanceId":"UserInputEndpoint","outputIndex":1,"toInstanceId":"UserInputInterpreter"},{"fromInstanceId":"UserInputInterpreter","outputIndex":1,"toInstanceId":"WrapOutput"},{"fromInstanceId":"UserInputInterpreter","outputIndex":2,"toInstanceId":"WrapOutput"},{"fromInstanceId":"UserInputInterpreter","outputIndex":3,"toInstanceId":"CreateNewModel"},{"fromInstanceId":"CreateNewModel","outputIndex":1,"toInstanceId":"WrapOutput"},{"fromInstanceId":"UserInputInterpreter","outputIndex":4,"toInstanceId":"AddDefinition"},{"fromInstanceId":"AddDefinition","outputIndex":1,"toInstanceId":"Model2Json"},{"fromInstanceId":"AddDefinition","outputIndex":1,"toInstanceId":"GetModelPath"},{"fromInstanceId":"GetModelPath","outputIndex":1,"toInstanceId":"SaveToFile"},{"fromInstanceId":"Model2Json","outputIndex":1,"toInstanceId":"SaveToFile"},{"fromInstanceId":"AddDefinition","outputIndex":1,"toInstanceId":"OnSaveModelSuccess"},{"fromInstanceId":"SaveToFile","outputIndex":1,"toInstanceId":"OnSaveModelSuccess"},{"fromInstanceId":"OnSaveModelSuccess","outputIndex":1,"toInstanceId":"WrapOutput"},{"fromInstanceId":"WrapOutput","outputIndex":1,"toInstanceId":"CommandLineOutputEndpoint"}]}],"activeFlow":{"name":"minimalFlow","instances":[{"id":"UserInputEndpoint","definition":{"jsonClass":"InputEndpoint","name":"UserInputEndpoint","outputType":{"name":"UserInput"}}},{"id":"UserInputInterpreter","definition":{"jsonClass":"PureFunction","name":"UserInputInterpreter","inputs":[{"inputType":{"name":"UserInput"},"index":1}],"outputs":[{"outputType":{"name":"UnknownCommand"},"index":1},{"outputType":{"name":"QuitCommand"},"index":2},{"outputType":{"name":"CreateModelCommand"},"index":3},{"outputType":{"name":"AddInputEndpointCommand"},"index":4},{"outputType":{"name":"AddFunctionCommand"},"index":5},{"outputType":{"name":"AddOutputEndpointCommand"},"index":6},{"outputType":{"name":"CreateFlowCommand"},"index":7},{"outputType":{"name":"AddInstanceCommand"},"index":8},{"outputType":{"name":"ConnectElementCommand"},"index":9}]}},{"id":"WrapOutput","definition":{"jsonClass":"PureFunction","name":"WrapOutput","inputs":[{"inputType":{"name":"java.lang.Object"},"index":1}],"outputs":[{"outputType":{"name":"WrappedOutput"},"index":1}]}},{"id":"CommandLineOutputEndpoint","definition":{"jsonClass":"OutputEndpoint","name":"CommandLineOutputEndpoint","inputs":[{"inputType":{"name":"WrappedOutput"},"index":1}],"outputType":{"name":"Unit"},"errorOutputs":[]}},{"id":"CreateNewModel","definition":{"jsonClass":"OutputEndpoint","name":"CreateNewModel","inputs":[{"inputType":{"name":"CreateModelCommand"},"index":1}],"outputType":{"name":"ModelCreationSuccess"},"errorOutputs":[]}},{"id":"AddDefinition","definition":{"jsonClass":"PureFunction","name":"AddDefinition","inputs":[{"inputType":{"name":"Model"},"index":1},{"inputType":{"name":"AddDefinitionCommand"},"index":2}],"outputs":[{"outputType":{"name":"Model"},"index":1}]}},{"id":"Model2Json","definition":{"jsonClass":"PureFunction","name":"Model2Json","inputs":[{"inputType":{"name":"Model"},"index":1}],"outputs":[{"outputType":{"name":"java.lang.String"},"index":1}]}},{"id":"GetModelPath","definition":{"jsonClass":"PureFunction","name":"GetModelPath","inputs":[{"inputType":{"name":"Model"},"index":1}],"outputs":[{"outputType":{"name":"Path"},"index":1}]}},{"id":"SaveToFile","definition":{"jsonClass":"OutputEndpoint","name":"SaveToFile","inputs":[{"inputType":{"name":"Path"},"index":1},{"inputType":{"name":"java.lang.String"},"index":2}],"outputType":{"name":"Unit"},"errorOutputs":[{"outputType":{"name":"java.lang.String"},"index":1}]}},{"id":"OnSaveModelSuccess","definition":{"jsonClass":"PureFunction","name":"OnSaveModelSuccess","inputs":[{"inputType":{"name":"Model"},"index":1},{"inputType":{"name":"Unit"},"index":2}],"outputs":[{"outputType":{"name":"ModelUpdateSuccess"},"index":1}]}}],"connections":[{"fromInstanceId":"UserInputEndpoint","outputIndex":1,"toInstanceId":"UserInputInterpreter"},{"fromInstanceId":"UserInputInterpreter","outputIndex":1,"toInstanceId":"WrapOutput"},{"fromInstanceId":"UserInputInterpreter","outputIndex":2,"toInstanceId":"WrapOutput"},{"fromInstanceId":"UserInputInterpreter","outputIndex":3,"toInstanceId":"CreateNewModel"},{"fromInstanceId":"CreateNewModel","outputIndex":1,"toInstanceId":"WrapOutput"},{"fromInstanceId":"UserInputInterpreter","outputIndex":4,"toInstanceId":"AddDefinition"},{"fromInstanceId":"AddDefinition","outputIndex":1,"toInstanceId":"Model2Json"},{"fromInstanceId":"AddDefinition","outputIndex":1,"toInstanceId":"GetModelPath"},{"fromInstanceId":"GetModelPath","outputIndex":1,"toInstanceId":"SaveToFile"},{"fromInstanceId":"Model2Json","outputIndex":1,"toInstanceId":"SaveToFile"},{"fromInstanceId":"AddDefinition","outputIndex":1,"toInstanceId":"OnSaveModelSuccess"},{"fromInstanceId":"SaveToFile","outputIndex":1,"toInstanceId":"OnSaveModelSuccess"},{"fromInstanceId":"OnSaveModelSuccess","outputIndex":1,"toInstanceId":"WrapOutput"},{"fromInstanceId":"WrapOutput","outputIndex":1,"toInstanceId":"CommandLineOutputEndpoint"}]}}"""
    }
  }
}